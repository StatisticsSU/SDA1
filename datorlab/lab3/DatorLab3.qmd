---
title: "Statistik och dataanalys I, 15 hp "
subtitle: "Datorlaboration 3"
author: 
  - Matias Quiroz
  - Mona Sfaxi
date: last-modified
format: 
  html:
    self-contained: true
toc: true
execute:
  error: false
language: 
  title-block-author-single: " "
toc-title-document: "Inneh친ll"
crossref-fig-title: "Figur"
theme: Superhero
title-block-banner-color: Primary
title-block-published: "Publicerad"
callout-warning-caption: "Varning"
callout-note-caption: "Observera"
callout-tip-caption: "Tips"
editor: visual
---

::: callout-warning
Den h칛r labben f칬ruts칛tter att f칬ljande paket finns installerade:

-   `openxlsx`

-   `mosaic`

-   `vcd`

-   `dplyr`

Paket kan installeras via kommandot `install.packages('packagename')`, d칛r `'packagename'` 칛r namnet p친 paketet, t.ex `'mosaic'`.
:::

## Introduktion

> I den h칛r datorlabben kommer vi att beskriva samband mellan tv친 kategoriska variabler, samt samband mellan en numerisk och kategorisk variabel. Ni kommer ocks친 l칛ra er om betingade f칬rdelningar i R och hur man j칛mf칬r f칬rdelningar grafiskt. Vi kommer ocks친 att arbeta med tidsserier.

#### 游눩 Uppgift 0.1

Skapa en mapp `Lab3` i din kursmapp SDA1 (s친som ni gjorde i Lab 1). Ladda ner Quarto-filen f칬r denna lab genom att h칬gerklicka [h칛r](https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab3/DatorLab3.qmd) och v칛lj 'Spara l칛nk' eller n친got likande fr친n menyn som dyker upp. Spara filen i din nya `Lab3` mapp. 칐ppna Quarto-filen i RStudio. Du kan nu forts칛tta med denna laboration direkt i Quarto-dokumentet, d칛r du ocks친 fyller i svaren p친 dina laborations칬vningar. Du kan allts친 l칛mna den h칛r webbsidan nu och forts칛tta arbetet i RStudio.

V칛l inne i RStudio med 칬ppnat Quarto-dokument i 'Editor' kan ni g친 칬ver till 'Source mode' genom att klicka p친 'Source' i det v칛nstra h칬rnet av din 'Editor'. Source mode 칛r detaljerat och bra att skriva kod i eftersom man har full kontroll p친 dokumentet, men det 칛r sv친rt att f친 en 칬versikt av dokumentet. Prova nu att g친 칬ver till 'Visual mode' genom att klicka p친 'Visual' i det v칛nstra h칬rnet av din 'Editor'. Vi rekommenderar att ni mestadels arbetar i Visual mode, men att g친 칬ver till Source mode n칛r man verkligen f친 till n친gon detalj som 칛r sv친r att 칛ndra i Visual mode. 췂

#### 游눩 Uppgift 0.2

Klicka p친 knappen Render i Editor-f칬nstret f칬r att **kompilera** filen till en webbsida (html). Webbsidan kommer antingen att visas i Viewer-f칬nstret i RStudio eller i webbl칛saren p친 din dator. Om din webbsida visas i webbl칛saren rekommenderar vi att du 칛ndrar inst칛llningarna i RStudio s친 webbsidan visas i Viewer-f칬nstret. Du st칛ller in detta p친 menyn [T]{.underline}ools/[G]{.underline}lobal Options... och sen v칛ljer du *Viewer Pane* vid *Show output preview in*:

![](https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab2/QuartoInViewerPane.png){fig-align="center" width="333"}

#### 游눩 Uppgift 0.3

F칬r att s칛kerst칛lla att man befinner sig i korrekt arbetsmapp varje g친ng Quarto-dokumentet kompileras kan man skapa en s k code-chunk efter den s k YAML-texten (som 친terfinns l칛ngst upp i dokumentet, mellan de tre bindestrecken - - -). Du skapar en code-chunk genom att klicka p친 knappen med C och ett + i 칬vre h칬gra h칬rnet av Editorn.

![](https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab2/codechunk.png){fig-align="center" width="200" height="26"}

::: callout-note
### RStudios Editor 칛ndras beroende p친 vilken sorts fil du har 칬ppen

Notera att ikonerna i Editor 칛r annorlunda n칛r du har ett Quarto-dokument 칬ppet j칛mf칬rt med tidigare n칛r vi hade en fil med ren R-kod 칬ppen.
:::

L칛gg till en ny code chunk och st칛ll in 'working directory' till den nya mappen genom att f칬lja anvisningarna fr친n [Lab 1](https://statisticssu.github.io/SDA1/datorlab/lab1/DatorLab1.html#st%C3%A4lla-in-arbetsmappen-working-directory-i-r).

::: callout-tip
Funktionen `setwd()` i R talar om f칬r R vilken mapp som 칛r 'working directory'.
:::

#### 游눩 Uppgift 0.4

Ladda ner `SmartPhones.RData` ([h칛r](https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/SmartPhones.RData?raw=true)), `FevChildren.RData` ([h칛r](https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/FevChildren.RData?raw=true)) och `CAPM_data.RData` ([h칛r](https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/CAPM_data.RData?raw=true)). Filerna kommer automatiskt att sparas ner, oftast i download mappen p친 datorn ni sitter vid. Kopiera 칬ver filerna till `Lab3` mappen ni skapade ovan.

Det finns olika s칛tt att l칛sa in `.RData` filer genom `load()` funktionen. Ett s칛tt 칛r att skriva t.ex `load("SmartPhones.RData")`. Notera att det h칛r f칬ruts칛tter att `SmartPhones.RData` ligger i den arbetsmappen man angivit genom `setwd()` funktionen. Ett annat s칛tt att ladda in en `.RData` fil 칛r att l칛sa in den direkt fr친n webben med en kombination av `load()` funktionen och `url()` funktionen.

```{r}
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/SmartPhones.RData?raw=true"))
Smartphones_from_URL <- SmartPhones
```

Argumentet till `url()` funktionen 칛r en str칛ng som inneh친ller l칛nken till kurshemsidans git repository d칛r `SmartPhones.RData` finns lagrad. I raden efter har vi sparat dataframen i en variabel som heter `SmartPhones_from_URL` s친 att du i n칛sta uppgift kan j칛mf칬ra mot den du l칛ser in fr친n din lokala fil som du sparade ovan i i `Lab3` mappen.

#### 游눩 Uppgift 0.5

Anv칛nd `load()` funktionen (utan `url()` funktionen) f칬r att l칛sa in `SmartPhones.RData` lokalt fr친n din dator. J칛mf칬r den lokalt inl칛sta filen med den du l칛ste in fr친n webben (finns sparad i `SmartPhones_from_URL`).

```{r}
# Write your code here
```

::: callout-tip
F칬r att j칛mf칬ra dataseten h칛r r칛cker det att anv칛nda `str()` och `head()`.
:::

Det 칛r viktigt att ni vet hur man l칛ser in `.RData` filer lokalt. Det kan vara s친 att github 칛r tillf칛lligt nere, eller att ni tempor칛rt jobbar utan tillg친ng till internet. I resten av labben s친 l칛ses filerna in fr친n webben, men nu vet ni hur ni kan g칬ra om webben av n친gon anledning skulle vara nere.

## 1. Simultan och marginella f칬rdelningar utifr친n en korstabell

**Kategoriska variabler** 칛r variabler vars utfall 칛r kategorier. I Lab 1 l칛rde vi oss att uttrycka f칬rdelningen f칬r en kategorisk variabel via en frekvenstabell uttryckt i andelar. En f칬rdelning av en endaste variabel, till exempel $y$, kallas f칬r **marginalf칬rdelningen** f칬r $y$. N칛r vi betraktar tv친 kategoriska variabler, till exempel $x$ och $y$ , s친 finns det olika f칬rdelningar vi kan t칛nka oss:

-   **Marginella f칬rdelningar**, en f칬rdelning f칬r vardera variabel $x$ och $y$.
-   **Simultan f칬rdelning** f칬r variablerna $x$ och $y$ (endast en f칬rdelning).
-   **Betingade f칬rdelningar**, en f칬rdelning f칬r vardera variabel $x$ och $y$, betingat p친 den andra.

Notera att dessa tre typer av f칬rdelningar finns oavsett om variablerna 칛r numeriska eller kategoriska. N칛r b칛gge variablerna 칛r kategoriska r칛knas dessa f칬rdelningar utifr친n en s친 kallad korstabell (se nedan). Att k칛nna till de olika f칬rdelningstyperna 칛r mycket viktigt och den kunskapen till칛mpas p친 alla statistikkurser fram칬ver. Att f칬rst친 dessa, samt kunna urskilja dom fr친n varandra, kommer att underl칛tta f칬rst친elsen av statistik s친v칛l som sannolikhetsteori som ni kommer st칬ta p친 under Del 2 av kursen.

F칬r att illustrera dessa koncept i ett praktiskt problem ska vi unders칬ka om det f칬religger ett samband mellan vilken smartphone man f칬redrar och vilken 친lderskategori man tillh칬r. Data finns i `SmartPhones.RData`.

```{r}
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/SmartPhones.RData?raw=true")) 
str(SmartPhones)
head(SmartPhones) # Prints first few observations

```

L친t oss b칬rja med att skapa en korstabell. En korstabell 칛r en tabell som inneh친ller frekvensen f칬r varje utfall av variablerna. Notera att om vi har tv친 kategoriska variabler, s칛g $x$ och $y$, s친 칛r utfallen alla parvisa kombinationer av utfallen av de respektive variablerna.

```{r}
#install.packages("mosaic") # Run if mosaic is not installed
suppressMessages(library(mosaic))
tally(~ brand + age.group, data = SmartPhones)
```

Eftersom `age.group` har 3 utfall och `brand` har 9 utfall, finns det totalt $3\cdot9=27$ olika utfall i korstabellen.

Formula-syntaxen (n칛mndes i [Lab 1](https://statisticssu.github.io/SDA1/datorlab/lab1/DatorLab1.html#tre-dialekter-av-r)) `~ brand + age.group` talar om att vi vill g칬ra en frekvenstabell av `brand` och `age.group`. Vi kan ocks친 anv칛nda tecknet `&` ist칛llet f칬r `+`.

#### 游눩 Uppgift 1.1

G칬r en korstabell genom att anv칛nda `&` ist칛llet f칬r `+`. Sl칛ng 칛ven om ordningen p친 variablerna, dvs `age.group` f칬re `brand`. F칬r칛ndras frekvensantalen?

```{r}
# Write your code here
```

Vi kan l칛gga till radsummor och kolumnsummor till korstabellen genom argumentet `margins = TRUE`.

```{r}
tally(~ brand + age.group, data = SmartPhones, margins = TRUE) # Show row and column totals
```

#### 游눩 Uppgift 1.2

Svara p친 f칬ljande fr친gor:

-   Hur m친nga deltog i unders칬kningen?

-   Hur m친nga f칬redrog en Casio smartphone?

-   Hur m친nga i 친ldersgruppen 18-34 f칬redrog en Samsung telefon?

Tabeller 칛r ofta enklare att utl칛sa n칛r de anges i relativa frekvenser (alternativt i procentform). Detta kan 친stadkommas med argumentet `format`.

```{r}
tally(~ brand + age.group, data = SmartPhones, margins = TRUE, format = "proportion")
tally(~ brand + age.group, data = SmartPhones, margins = TRUE, format = "percent")
```

F칬rdelningen ovan i de celler som inte inkluderar Total 칛r den **simultana f칬rdelningen** f칬r variablerna, dvs:

```{r}
tally(~ brand + age.group, data = SmartPhones, margins = FALSE, format = "proportion")
```

En cell i den simultana f칬rdelningen anger andelen av **det totala antalet** som hamnar i det utfallet. Exempelvis 칛r $\approx 0.088$ ($\approx 8.8\%$ ) av alla 2498 deltagare i 친ldersgruppen 35-49 och f칬redrar en iPhone. En f칬rdelning summerar alltid till 1, vilket bekr칛ftades ovan n칛r vi inkluderade Total via `margins = TRUE` (cellen l칛ngst ner till h칬ger).

#### 游눩 Uppgift 1.3

Svara p친 f칬ljande fr친gor:

-   Hur stor andel av alla f칬redrog en Casio smartphone?

-   Hur stor andel av alla tillh칬rde 친ldersgruppen 18-34 samt f칬redrog en Samsung telefon?

-   Vad 칛r problemet med p친st친endet "Ca 14% av de tillfr친gade i 친ldersgruppen 18-34 f칬redrog en iPhone"?\

#### 游눩 Uppgift 1.4

Anv칛nd `tally()` funktionen s친som ni gjorde i [Lab 1](https://statisticssu.github.io/SDA1/datorlab/lab2/DatorLab2.html#uppgift-1.1) f칬r att ber칛kna marginalf칬rdelningen f칬r vardera variabel. Anv칛nd argumentet `format = "proportion"`. K칛nner ni igen dessa f칬rdelningar fr친n tidigare i labben?

```{r}
# Write your code here.
```

Marginalf칬rdelningarna kan allts친 f친s via kolumntotalen och radtotalen i simultanf칬rdelningen via argumentet `margins = TRUE`.

#### 游눩 Uppgift 1.5

Vad summerar varje marginalf칬rdelning till? Du b칬r kunna svara p친 den h칛r fr친gan utan att koda.

## 2. Betingade f칬rdelningar utifr친n en korstabell

I sista delfr친gan p친 Uppgift 1.3 fr친gades vad problemet med p친st친endet "Ca 14% av de tillfr친gade i 친ldersgruppen 18-34 f칬redrog en iPhone" var. P친st친endet hade varit korrekt om formuleringen var "Ca 14% av **alla** tillfr친gade tillh칬rde 친ldersgruppen 18-34 och f칬redrog en iPhone". F칬r att r칛kna ut den korrekta andelen i det felaktiga p친st친endet m친ste vi enbart betrakta de tillfr친gade som tillh칬r 친ldersgruppen 18-34, dvs 868 personer (enligt tabellen i Uppgift 1.1). Av dessa f칬redrog 354 personer iPhone (enligt tabellen i Uppgift 1.1). Den korrekta andelen ber칛knas s친ledes till $354/868\approx 0.41$, eller ca 41%.

Terminologin 칛r viktig att l칛ra sig. Vi s칛ger att vi har en betingad f칬rdelning f칬r smartphonepreferens betingat p친 친ldersgrupp (i det h칛r fallet 친ldersgruppen 18-34). Ofta s칛ger vi enbart "f칬rdelning f칬r smartphonepreferens betingat p친 친ldersgrupp (i det h칛r fallet 친ldersgruppen 18-34)", och det 칛r underf칬rst친tt att det 칛r en betingad f칬rdelning. Vi skulle ocks친 kunna s칛ga "f칬rdelningen f칬r smartphonepreferens givet 친ldersgrupp".

Vi skulle kunna kunna r칛kna ut den betingade f칬rdelningen f칬r de 칬vriga utfallen f칬r hand, Asus ($25/868$), Casio ($25/868$), HTC ($26/868$), osv. **R칛kna ut f칬r hand 칛r viktigt p친 tentan, s친 se till att ni f칬rst친r hur man g칬r**! I praktiken l친ter vi datorn g칬ra r칛kningarna 친t oss. I R kan vi g칬ra detta genom anv칛ndning av formula-syntax tecknet `|`, som betyder betingat p친 variabeln som f칬ljer efter tecknet.

```{r}
tally(~ brand | age.group, data = SmartPhones, format = "proportion")
```

Ovan ser vi **tre olika betingade f칬rdelningar**, en f칬r varje 친ldersgrupp. En betingad f칬rdelning 칛r ocks친 en f칬rdelning: **En f칬rdelning summerar alltid till 1**. Vi kan bekr칛fta detta f칬r varje 친ldersgrupp genom att anv칛nda `margins = TRUE` som argument.

```{r}
tally(~ brand | age.group, data = SmartPhones, format = "proportion", margins = TRUE)
```

Notera att en Total f칬r radsummorna inte finns i tabellen. Detta beror p친 att R vet att vi betingar p친 a`~ age.group`, och d친 saknar radsummorna en betydelse och d칛rf칬r skrivs de inte ut.

Ett alternativ s칛tt att skriva betingningen `~ brand | age.group` 칛r `brand ~ age.group` , utan att anv칛nda `|`-tecknet. R tolkar d친 variabeln v칛nster om `~` som variabeln f칬rdelningen ska ber칛knas f칬r, och variabeln till h칬ger om `~` som variabeln det ska betingas p친. Det h칛r alternativa s칛ttet att skriva formula-syntax 칛r det som anv칛nds i m친nga R funktioner vi kommer att st칬ta p친 senare i kursen, till exempel `lm()` funktionen som anv칛nds i regression. 츿ven `plot()` och `boxplot()` som vi anv칛nder senare i den h칛r labben anv칛nder den alternativa formula-syntaxen.

#### 游눩 Uppgift 2.1

Anv칛nd den allternativa formula-syntaxen f칬r att ber칛kna den betingade f칬rdelningen ovan. St칛m av att resultaten blir desamma.

```{r}
# Write your code here
```

#### 游눩 Uppgift 2.2

Svara p친 f칬ljande fr친gor:

-   Vilken 칛r den popul칛raste smartphonen i 친ldersgruppen 35-49?

-   Hur stor andel av de i 친ldersgruppen 18-34 f칬redrar en Sony?

-   Hur stor andel av de i 친ldersgruppen 18-34 f칬redrar en Sony eller en Samsung?

-   Vad 칛r problemet med p친st친endet "Bland de som f칬redrar iPhone 칛r det en st칬rre andel, ca 40%, som tillh칬r 친ldersgruppen 18-34 gentemot ca 29% som tillh칬r 친ldersgruppen 50+"?

#### 游눩 Uppgift 2.3

Uttryck de betingade f칬rdelningarna ovan i procentform ist칛llet f칬r andelar.

```{r}
# Write your code here
```

::: callout-tip
Kom ih친g att argumentet `format` best칛mmer tabellens format.
:::

I sista delfr친gan p친 Uppgift 2.2 fr친gades vad problemet med p친st친endet "Bland de som f칬redrar iPhone 칛r det en st칬rre andel, ca 40%, som tillh칬r 친ldersgruppen 18-34 gentemot ca 29% som tillh칬r 친ldersgruppen 50+" . Det finns tv친 varningstecken h칛r. Det f칬rsta 칛r formuleringen "Bland de som f칬redrar en iPhone...", vilket betyder att vi bara betraktar de som har en iPhone --- dvs vi m친ste betinga p친 iPhone! Andra varningstecknet 칛r att vi uttalar oss om andelar f칬r 친ldersgrupper --- den betingade f칬rdelningen vi skapade ovan 칛r andelar 칬ver smartphonepreferens, inte 칬ver 친ldersgrupper! De andelar vi har angett i p친st친endet 칛r s친ledes felaktiga.

#### 游눩 Uppgift 2.4

Ber칛kna (med hj칛lp av R) den betingade f칬rdelningen som hj칛lper oss att r칛tta till det felaktiga p친st친endet.

```{r}
# Write your code here
```

::: callout-tip
Om du har f칬rst친tt inneb칬rden av formula-syntaxen `~ brand | age.group` (eller alternativt `brand ~ age.group`) borde denna uppgift vara enkel.
:::

#### 游눩 Uppgift 2.5

R칛tta det felaktiga p친st친endet i sista delfr친gan p친 Uppgift 2.2.

## 3. J칛mf칬ra f칬rdelningar f칬r kategoriska variabler

N칛r vi j칛mf칬r variablers f칬rdelningar 칛r det ofta via grafiska metoder. Vilken typ av plot som 칛r l칛mpligast beror p친 om variablerna vi j칛mf칬r 칛r numeriska eller kategoriska. Vi b칬rjar med fallet d친 b친da variablerna 칛r kategoriska, dvs samma scenario som i Avsnitt 2 ovan.

Visst skulle vi till exempel kunna kolla p친 andelarna f칬r smartphonepreferens betingat p친 친ldersgrupp vi r칛knade i Avsnitt 2, dvs:

```{r}
tally(~ brand | age.group, data = SmartPhones, format = "proportion")
```

Fr친n dessa betingade f칬rdelningar ser vi till exempel att iPhone 칛r den popul칛raste smartphonen i 친ldersgruppen 18-34 och n칛st popul칛raste i de andra tv친 친ldersgrupperna. Vi ser ocks친 att andelen som f칬redrog iPhone var ca 41% i 친ldersgruppen 18-34, gentemot ca 33% bland 친ldersgruppen 35-49 och ca 29% i 친ldersgruppen 50+.

Informationen i tabellen ovan blir 칛nnu tydligare i n칛r den presenteras med ett stapeldiagram f칬r varje 친ldersgrupp.

```{r}
bargraph(~ brand | age.group, data = SmartPhones, type = "proportion")
```

#### 游눩 Uppgift 3.1

Svara p친 f칬ljande fr친gor:

-   Vad kan man s칛ga om preferensen f칬r Others-kategorin mellan 친ldersgrupperna?

-   Vilken 칛r den popul칛raste smartphonen f칬r respektive 친ldersgrupp?

-   츿r p친st친endet ''Summan av alla staplarna f칬r 친ldersgruppen 50+ 칛r 1'' korrekt? Varf칬r/varf칬r inte?

-   츿r p친st친endet ''Summan av iPhone staplarna 칬ver de tre 친ldersgrupperna 칛r 1'' korrekt? Varf칬r/varf칬r inte?

#### 游눩 Uppgift 3.2

Anv칛nd `bargraph()` f칬r att plotta de betingade f칬rdelningarna f칬r 친ldersgrupperna betingat p친 smartphonepreferens.

```{r}
# Write your code here
```

#### 游눩 Uppgift 3.3

Svara p친 f칬ljande fr친gor:

-   Hur ser 친ldersf칬rdelningen ut f칬r smartphonepreferensen Others gentemot Casio?

-   Hur ser 친ldersf칬rdelningen ut f칬r smartphonepreferensen HTC?

-   츿r p친st친endet ''Summan av 50+ staplarna 칬ver de nio smartphonespreferensgrupperna 칛r 1'' korrekt? Varf칬r/varf칬r inte?

Vi kan ocks친 g칬ra ett staplat stapeldiagram (stacked barchart) f칬r att kompakt visa resultaten i Uppgift 3.2 F칬r detta anv칛nder vi `barplot()` funktionen i base R, d친 `mosaic`-paketet inte har en s친dan funktion (se nedan f칬r en liknande plot, mosaicplotten). Vi beh칬ver f칬rst skapa och spara den betingade f칬rdelningen med hj칛lp av `tally().`

```{r}
t <- tally(~ age.group | brand, data = SmartPhones, format = "prop")
barplot(t, col = c("aquamarine", "cornflowerblue", "darkblue"), xlab = "Brands", ylim = c(0,1.7), legend=c("18-34", "35-49", "50+"), las=2)
```

Det enda argumentet till funktionen ni inte har st칬tt p친 tidigare 칛r `las = 2`, som ser till att namnen p친 kategorierna hamnar vertikalt ist칛llet f칬r horisontellt (s친 de f친r plats i figuren).

#### 游눩 Uppgift 3.4

Vilken av de tv친 figurerna ovan tycker ni 칛r enklast att j칛mf칬ra proportionerna mellan grupperna i?

#### 游눩 Uppgift 3.5

Om vi, f칬r varje grupp vi betingar p친, ist칛llet vill ha staplarna bredvid varandra (och inte ovanp친 varandra) kan vi anv칛nda argumentet beside `beside = TRUE`. G칬r en s친dan plot.

```{r}
# Write your code here
```

Vi har g친tt igenom mosaicplot p친 F칬rel칛sning 4. Notera att namnet p친 plotten inte har med `mosaic`-paketet att g칬ra. En mosaicplot 칛r en stacked barchart, men inneh친ller ocks친 information om marginalf칬rdelningen p친 variabeln man betingar p친. Vi kan anv칛nda funktionen `mosaic()` fr친n `vcd`-paketet. Viktigt att notera att variabeln vi betingar p친 hamnar p친 y-axeln, till skillnad fr친n x-axeln som mosaicplottarna i boken.

```{r}
#install.packages("vcd") # Run if vcd is not installed.
suppressMessages(library(vcd))
t <- tally(~ age.group | brand, data = SmartPhones, format = "prop")
vcd::mosaic(~ age.group | brand, data = SmartPhones)
```

Notera att vi anropar funktionen via `vcd::mosaic()` ist칛llet f칬r `mosaic()`, d친 den senare refererar till `mosaic`-paketet och inte till funktionen `mosaic()` fr친n `vcd`-paketet som 칛r den vi vill anv칛nda.

Variabeln smartphonepreferens har f칬r m친nga utfall (kategorier), vilket g칬r mosaicplotten ol칛slig. Tyv칛rr har inte funktionen argumentet `las` vi anv칛nde oss av f칬r att rotera texten i `bargraph()`. F칬r enkelhetens skull, l친t oss definiera en ny dataframe d칛r vi endast beh친ller repondenter som har svarat iPhone, Samsung, LG eller Sony och illustrera mosaicplotten med dessa nya data. H칛r 칛r ett exempel d칛r tidyverse l칬ser uppgiften p친 ett mer elegant s칛tt 칛n base R med funktionen `filter()`.

```{r}
#install.packages("dplyr") # Run if dplyr is not installed.
library(dplyr)
SmartPhones_new <- filter(SmartPhones, brand == "iPhone" |brand == "Samsung"|brand == "LG" | brand == "Sony")
```

Notera att i koden ovan s친 har inte `|`-tecknet samma betydelse som i formula-syntax, d칛r den betyder betingat p친. I koden ovan betyder `|`-tecknet "eller". `filter` anropet ovan beh친ller allts친 de observationer som har v칛rdet `brand` lika med "iPhone" eller "Samsung" eller "LG" eller "Sony". Tecknet `==` 칛r en j칛mf칬relse, dvs `filter()` funktionen kollar om `brand` 칛r lika med de v칛rdena vi har angett och om s친 칛r fallet s친 beh친lls den. Om `brand` till exempel skulle ha v칛rdet "Casio" s친 kommer den inte att beh친llas.

#### 游눩 Uppgift 3.6

Anv칛nd `tally()` f칬r att ber칛kna den betingade f칬rdelningen `age.group` givet `brand` samt marginalf칬rdelningen f칬r `brand` f칬r den nya dataframen `SmartPhones_new`.

```{r}
# Write your code here

```

#### 游눩 Uppgift 3.7

Anv칛nd `vcd::mosaic()` f칬r att g칬ra en mosaicplot f칬r `age.group` givet `brand` f칬r den nya dataframen `SmartPhones_new`. St칛mmer de betingade f칬rdelningarna samt marginalf칬rdelningen i plotten 칬verens med de ni r칛knade fram i Uppgift 3.6?

```{r}
# Write your code here.
```

::: {.callout-note icon="false"}
## Extra: Ett f칬rsta steg mot att arbeta mer sj칛lvst칛ndigt.

Denna uppgift b칬r g칬ras f칬rst efter att man gjort klart resten av labben. Uppgiften kan hoppas 칬ver vid brist p친 tid, d친 ni redan l칛rt er beskriva samband mellan kategoriska variabler. Syftet med uppgiften 칛r att ni ska anv칛nda de verktygen ni har l칛rt er p친 ett sj칛lvst칛ndigt s칛tt.

Ni kan till칛mpa det ni har l칛rt er i Avsnitt 3 p친 ett nytt datamaterial. Vi f칬resl친r att ni analyserar sambandet mellan `Survived` och `Class` i Titanic datasetet. I [Lab 2](https://statisticssu.github.io/SDA1/datorlab/lab2/DatorLab2.html) analyserade ni variablerna var f칬r sig. Er uppgift nu 칛r att studera om det f칬religger ett samband mellan `Survived` och `Class` och hur detta samband ser ut.

```{r}
# install.packages("openxlsx") # # Run if openxlsx is not installed. 
suppressMessages(library(openxlsx)) # 
titanic <- read.xlsx("https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab2/Chapter_3.xlsx", sheet = "Titanic")

# Write your code here
```
:::

## 4. Samband mellan en numerisk och en kategorisk variabel

I [Lab 2](https://statisticssu.github.io/SDA1/datorlab/lab2/DatorLab2.html#grafisk-presentation-av-numeriska-variabler.html) presenterades histogrammet som ett verktyg att beskriva f칬rdelningen f칬r en numerisk variabel. Om vi vill studera hur sambandet mellan en numerisk och en kategorisk variabel ter sig 칛r det naturligt att g칬ra ett histogram av den numeriska variabeln f칬r varje utfall av den kategoriska variabeln. Ett s친dant histogram 칛r en betingad f칬rdelning, eftersom endast observationerna som tillh칬r utfallet vi betingar p친 f칬r den kategoriska variabeln anv칛nds vid konstruktionen av histogrammet.

L친t oss illustrera koncepten med ett dataset 칬ver forcerad utandningsvolym, forced expiratory volume (FEV) p친 engelska, hos 606 barn och ungdomar. De numeriska variblerna i datasetet 칛r forcerad utandningsvolym (`fev`), l칛ngd (`height`) och 친lder (`age`). De kategoriska variablerna 칛r r칬kare (`smoking`, ja kodat som 1 och nej kodat som 0), 친ldersgrupp (`age.group`) och k칬n (`gender`). Data finns i `FevChildren.RData`.

```{r}
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/FevChildren.RData?raw=true"))
str(FevChildren)
head(FevChildren)
```

#### 游눩 Uppgift 4.1

Anv칛nd `histogram()` funktionen fr친n `mosaic`-paketet f칬r att plotta den marginella f칬rdelningen f칬r `fev`. Ber칛kna de olika f칬rdelningsm친tten med hj칛lp av `favstats()` och beskriv f칬rdelningen.

```{r}
# Write your code here
```

Finns det n친got samband mellan den forcerade utandningsvolymen (`fev`) och 친ldersgrupp (`age.group`)? L친t oss g칬ra ett histogram f칬r den forcerade utandningsvolymen betingat p친 de olika 친ldersgrupp samt r칛kna ut f칬rdelningsm친tten f칬r att besvara fr친gan.

```{r}
histogram(~ fev | age.group, data = FevChildren)
favstats(~ fev | age.group, data = FevChildren)
```

Vi ser att de med de st칬rsta forcerade utandningsvolymen 친terfinns i den 칛ldsta 친ldersgruppen. Vi kan ocks친 se att b친de medelv칛rdet och medianen 칬kar med 친ldersgrupp. Resultaten 칛r f칬rv칛ntade d친 칛ldre barn och ungdomar har ocks친 st칬rre lungor.

#### 游눩 Uppgift 4.2

Hur ser sambandet mellan den forcerade utandningsvolymen (`fev`) och r칬kning (`smoking`) ut? 츿r resultaten f칬rv칛ntade?

```{r}
# Write your code here.
```

Vi kan ocks친 betinga p친 mer 칛n en variabel. Exempelvis kan vi plotta f칬rdelningen f칬r `fev` betingat p친 `smoking` och 친ldersgrupp (`age.group`).

```{r}
histogram(~ fev | smoking + age.group, data = FevChildren)
favstats(~ fev | smoking + age.group, data = FevChildren)
```

Vi s친g tidigare att de st칬rsta forcerade utandningsvolymen 친terfanns i den 칛ldsta 친ldersgruppen. Histogrammen i f칬rsta raden ovan visar att de ocks친 fanns bland icke-r칬karna. Notera att ett av utfallen, 친ldersgrupp 6-9 har endast 1 observation (en alltf칬r ung r칬kare). Det 칛r d친 inte s친 meningsfullt att vare sig plotta ett histogram eller r칛kna f칬rdelningsm친tt.

Bland 친ldersgrupp 15-17 ser vi att b친de medianen och medelv칛rdet 칛r h칬gre bland de som inte r칬ker j칛mf칬rt med r칬karna. F칬r 친ldersgrupp 10-14 칛r medianen och medelv칛rdet h칬gre bland de som r칬ker j칛mf칬rt med de som inte r칬ker. Betyder det att det 칛r b칛ttre f칬r lugnkapaciteten att r칬ka om man 칛r i 친ldersgruppen 10-14? Notera f칬rst att skillnaden mellan medelv칛rdena (och medianerna) f칬r 친ldersgrupp 15-17 mellan r칬kare och icke-r칬kare 칛r betydligt st칬rre j칛mf칬rt med de motsvarande skillnaderna f칬r 친ldersgrupp 10-14. Skillnaderna f칬r 친ldersgrupp 10-14 칛r ganska sm친 --- kan det vara s친 att det 칛r slumpfaktorn som har resulterat i h칬gre medelv칛rde (och median) f칬r r칬karna (j칛mf칬rt med icke-r칬karna) i 친ldersgrupp 10-14? Hade vi tagit ett nytt stickprov p친 606 nya barn och ungdomar hade vi kanske f친tt det omv칛nda resultatet, dvs att medelv칛rdet (och medianen) f칬r r칬karna i 친ldersgrupp 10-14 hade varit l칛gre 칛n icke-r칬karna i samma 친ldersgrupp. Ett resultat som 칛r orsakat av slumpen s칛gs vara icke signifikant (statistiskt insignifikant). F칬r att statistiskt s칛kerst칛lla att skillnaderna inte beror p친 slumpen beh칬ver vi v칛nta till kursens andra del, men det 칛r viktigt att ni redan nu f칬rst친r att **sm친 avvikelser kan bero p친 slumpen och inte dra f칬r mycket slutsatser**.

Vi kan ocks친 notera att formula-syntax med mosaicpaketet som vi har anv칛nt ovan 칛r kompakt och l칛tt att implementera. Vi kan g칬ra samma sorts figurer i base R, men det kr칛ver betydligt mer kod som 칛r dessutom kr친ngligare att f칬rst친 (klicka i marginalen om du 칛r intresserad).

::: column-margin
[![](https://github.com/StatisticsSU/SDA1/raw/main/misc/hexagons/figs/base_r_hexagon.svg){width="60"}](../../R/BaseRSyntax.qmd#histogram-per-kategori-i-separata-figurer)
:::

#### 游눩 Uppgift 4.3

Anv칛nd `histogram()` f칬r att plotta f칬rdelningen f칬r `fev` betingat p친 k칬n (`gender`) och `age.group`. Ber칛kna 칛ven f칬rdelningsm친tten med `favstats()` och kommentera resultaten.

```{r}
# Write your code here
```

Ett annat s칛tt att illustrera samband mellan en numerisk variabel och kategoriska variabler 칛r att anv칛nda en **boxplot** d칛r man betingar p친 de kategoriska variablerna. F칬rdelen med denna ansats 칛r att vi kan summera allt i en figur, ist칛llet f칬r att anv칛nda m친nga figurer som vi gjorde med histogram ansatsen. Det g친r att plotta flera histogram i samma plot med tidyverse-syntax och ocks친 med base R, men figuren kan bli ganska st칬kig (klicka i marginalen om du 칛r intresserad).

::: column-margin
[![](https://github.com/StatisticsSU/SDA1/raw/main/misc/hexagons/figs/base_r_hexagon.svg){width="60"}](../../R/BaseRSyntax.qmd#histogram-per-kategori-i-samma-figur) [![](https://github.com/StatisticsSU/SDA1/raw/main/misc/hexagons/figs/tidyverse_hexagon.svg){width="60" height="150"}](../../R/TidyverseSyntax.qmd#histogram-per-kategori-i-samma-figur)
:::

F칬ljande kod plottar samma f칬rdelning som i Uppgift 4.3, men med `boxplot()` ist칛llet f칬r `histogram()`. Som vi noterade i Avsnitt 2 s친 anv칛nder `boxplot()` den alternativa formula-syntaxen, dvs ist칛llet f칬r `~ fev | gender + age.group` skriver vi `fev ~  gender + age.group`.

```{r}
boxplot(fev ~ gender + age.group, data = FevChildren)
```

En f칬rdel med boxplotten kontra histogrammet 칛r att alla medianer visas, dessutom i samma figur, vilket f칬renklar j칛mf칬relser mellan grupperna utan att beh칬va anv칛nda `favstats()`.

#### 游눩 Uppgift 4.4

Anv칛nd `boxplot()` f칬r att j칛mf칬ra f칬rdelningarna f칬r `fev` betingat p친 olika utfall av `smoking` `age.group`. Ovan hade vi en diskussion om statistisk signifikans f칬r samma exempel. Ser ni i figuren att skillnaderna f칬r medianerna i 친ldersgrupp 10-14 mellan r칬kare och icke r칬kare 칛r liten j칛mf칬rt med samma skillnad i 친ldersgrupp 15-17? Vilken av dessa skillnader 칛r mest trolig att vara statistiskt signifikant?

```{r}
# Write your code here
```

## 5. Tidsserier

Tidsserieanalys 칛r ett stort omr친de inom statistik. I den h칛r kursen g친r vi inte in s친 mycket p친 tidsserier, mer 칛n att l칛r oss att plotta dom.

Filen `CAPM_data.RData` inneh친ller tidsserier 칬ver m친nadsavkastningar f칬r olika finansiella tillg친ngar samt makroekonomiska variabler s친som obligationsr칛nta (`RKFREE`) och konsumentprisindex (`CPI`). Observationerna 칛r ordnade i tid, d칛r f칬rsta observationen 칛r fr친n januari 1978 och sista observationen 칛r fr친n december 1987. Observationerna 칛r p친 m친nadsfrekvens, s친 vi har totalt 120 observationer (12 per 친r under 10 친r). M친nadsavkastningen $r_t$ f칬r en finansiell tillg친ng som 칛r v칛rderar till $S_t$ i period $t$ definieras som $$r_t=\frac{S_t-S_{t-1}}{S_{t-1}}.$$

Exempelvis, antag att tillg친ngen var v칛rderad till 105 vid tidpunkten $t-1$, dvs $S_{t-1}=100$, och 110 vid tidpunkten $t$, dvs $S_{t}=110$. D친 칛r m친nadsavkastningen i perioden $t$

$$r_t = \frac{110 - 105}{105} \approx 0.048,$$

dvs en uppg친ng p친 n칛stan 5% j칛mf칬rt med f칬reg친ende m친nad.

Vi l칛ser in data samt inspekterar variabeltyperna.

```{r}
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/datorlab/lab3/CAPM_data.RData?raw=true"))
str(CAPM)
```

Notera att dataframen som laddas in heter `CAPM` och inte `CAPM_data`. Det finns ingen koppling mellan filnamnet och namnet p친 dataframen i R. Namnet p친 dataframen best칛ms av vad den d칬ptes till n칛r den sparades, i det h칛r fallet `CAPM`.

Vi noterar att alla variabler f칬rutom `DATE` 칛r numeriska. `DATE` 칛r i s친kallad Date-format, vilket g칬r att R f칬rst친r att det 칛r ett datum, trots att den verkar lagras som str칛ngar enligt utskriften ovan. R behandlar allts친 inte `DATE` som en kategorisk variabel.

Datasetet inneh친ller variabeln `MARKET`, vilket 칛r marknadsportf칬ljensavkastning (dvs alla tillg친ngar i marknaden). Vi kan g칬ra en tidsserieplot f칬r marknadsportf칬ljens avkastning.

```{r}
plot(MARKET ~ DATE, data = CAPM, col = "darkblue")
```

Eftersom det vi plottar 칛r en tidsserie s친 칛r observationerna ordnade och d친 칛r det vanligt att man binder ihop observationerna med linjer, dvs en linjeplot. Detta kan vi g칬ra genom att anv칛nda argumentet `type = "l"` i funktionen `plot()`, d칛r "l" st친r f칬r line.

```{r}
plot(MARKET ~ DATE, data = CAPM, col = "darkblue", type = "l")
```

#### 游눩 Uppgift 5.1

Om vi tycker att linjen 칛r f칬r tunn kan vi kontrollera dess tjocklek med `plot()` funktionens argument `lwd` som st친r f칬r linewidth. Defaultv칛rdet (dvs v칛rdet som anv칛nds om inget annat anges) 칛r `lwd = 1`. Om vi vill ha en linje som 칛r 50% tjockare anger vi `lwd = 1.5`. G칬r om plotten ovan med en dubbelt s친 tjock linje.

```{r}
# Write your code here
```

Fr친n tidsserieplotten ser vi ser att, 칬ver en l친ng period, s친 kan marknaden ha ganska kraftiga sv칛ngningar.

#### 游눩 Uppgift 5.2

Black Monday 칛r namnet p친 en av de v칛rsta b칬rskrascherna n친gonsin. Black Monday intr칛ffade oktober 1987. Kan ni se Black Monday h칛ndelsen i tidsserien? Hur mycket f칬ll marknadsportf칬ljen den m친naden?

```{r}
# Write your code here
```

::: callout-tip
Ibland kan det vara bra att kunna h칛mta ut en variabel fr친n en dataframe. Antag att vi har en dataframe `my_data` med en variabel vid namn `x`. Vi kan anv칛nda `$`-tecken f칬r att h칛mta ut den variabeln fr친n dataframen. Vi skriver d친 `my_data$x`.
:::

#### 游눩 Uppgift 5.3

Plotta tidsserien f칬r tillg친ngen `CITCRP`. Hur drabbades `CITCRP` av Black Monday j칛mf칬rt med marknadsportf칬ljen?

```{r}
# Write your code here
```

Notera att varje g친ng vi anropar `plot()` funktionen s친 skapas en ny figur. Ibland vill man plotta flera tidsserierna i samma graf. Detta kan 친stadkommas genom att skapa f칬rsta figuren med `plot()`, precis som vi gjort innan, och efterf칬ljande figurer med `lines()`. `lines()` st칬djer inte formula-syntax, s친 det h칛r 칛r ytterligare ett exempel p친 varf칬r det 칛r viktigt att kunna h칛mta ut variabler fr친n en dataframe med hj칛lp av `$`-tecknet. F칬ljande kod plottar tidsserierna f칬r marknadsportf칬ljen och `CITCRP` i samma graf. Koden l칛gger ocks친 till etiketter via `legend()` funktionen och justerar y-axelns definitionsomr친de via argumentet `ylim`, som ni ocks친 anv칛nde i [Lab 2](https://statisticssu.github.io/SDA1/datorlab/lab2/DatorLab2.html).

```{r}
plot(MARKET ~ DATE, data = CAPM, col = "darkblue", type = "l", lwd = 2, ylim = c(-0.4, 0.4))
lines(x = CAPM$DATE, y = CAPM$CITCRP, col = "lightblue", type = "l", lwd = 2)
legend(x = "topright", lty = 1 , lwd = 2, col = c("darkblue", "lightblue"), legend=c("Market", "CITCRP"))
```

#### 游눩 Uppgift 5.4

Plotta de tre tidsserierna `MARKET`, `CITCRP` och `DATGEN` i samma figur. Anv칛nd l칛mpliga f칛rger samt etiketter. Verkar tidsserierna f칬ljas 친t? Vad tror ni att det beror p친?

```{r}
# Write your code here
```

#### 游눩 Uppgift 5.5

Antag att ni skapar en portf칬lj som best친r av 30% `IBM`, 50% `CITCRP`och 20% `DATGEN`. Plotta m친nadsavkastningen f칬r er portf칬lj.

::: callout-tip
Avkastningen f칬r en portf칬lj 칛r en viktad linj칛r kombination av avkastningarna i tillg친ngarna som portf칬ljen inneh친ller. I en portf칬lj med tre aktier vars vikter $0<w_1<1, 0<w_2<1, 0<w_3<1$, med $\sum_{k=1}^3w_k=1$, 칛r portf칬ljens avkastning$$r_t = w_1r^{(1)}_t + w_2r^{(2)}_t+w_3r^{(3)}_t,$$

d칛r $r^{(k)}_t$ 칛r avkastningen f칬r tillg친ng $k$ i portf칬ljen.

Nu n칛r ni vet hur man kan anv칛nda `$`-tecken f칬r att h칛mta ut variabler fr친n en dataframe, kan ni lista ut hur man skapar en ny variabel som viktar variablerna enligt ovan (30% `IBM`, 50% `CITCRP`och 20% `DATGEN`).
:::

## 6. Sammanfattning {#sammanfattning}

::: callout-info
## I den h칛r laborationen har du l칛rt dig:

-   Metoder f칬r att r칛kna ut simultan f칬rdelning, marginella f칬rdelningar, samt betingade f칬rdelningar.

-   Hur man j칛mf칬r f칬rdelningar grafiskt. Olika metoder anv칛nds beroende p친 om en variablerna 칛r numeriska eller kategoriska.

-   Hur man informellt resonerar kring statistisk signifikans.

-   Hur man kan presentera tidsseriedata med linjeplottar.

-   N친gra exempel p친 vad en `for`-loop kan anv칛ndas till.
:::

## A. Appendix

Lista 칬ver n친gra vanliga argument i grafer

-   col = f칛rg, kan markeras med siffror eller med namnet p친 f칛rgen, oftast med sm친 bokst칛ver. Gl칬m ej att texten m친ste ligga inom citattecken.

-   main = rubrik p친 plotten, detta s칛tts till en textstr칛ng, allts친 en text inom citattecken.

-   xlab = rubrik p친 x-axeln, detta s칛tts till en textstr칛ng, allts친 en text inom citattecken.

-   ylab = rubrik p친 y-axeln, detta s칛tts till en textstr칛ng, allts친 en text inom citattecken.

-   xlim = definitionsomr친de f칬r x-axeln. Exempelvis betyder xlim = c(0, 14.3) att det l칛gsta v칛rdet som ritas kommer att vara 0 och det h칬gsta v칛rdet kommer att vara 14.3 (p친 x-axeln).

-   ylim = definitionsomr친de f칬r y-axeln. Exempelvis betyder ylim = c(-2, 20.7) att det l칛gsta v칛rdet som ritas kommer att vara -2 och det h칬gsta v칛rdet kommer att vara 20.7 (p친 y-axeln).

-   lwd = tjocklecken p친 linjer (eller prickar) i ett linjediagram (spridningsdiagram), anges med ett nummer.

-   lty = typ av linje (rak, streckad, prickad etc) i ett linjediagram, anges med ett nummer.

-   pch = typ av prick (rund, fyrkantig + \* etc), s칛tts till ett nummer.

-   breaks = antal staplar i ett histogram.

-   cex = justering av etiketternas storlek i en figur (exempelvis cex = 0.5 i en `legend()` funktion minskar storleken som "legend-texten" tar upp i en figur med h칛lften). Finns 칛ven exempelvis cex.axis, cex.main f칬r att justera storleken av texter p친 axlar respektive rubrik.

-   bg = bakgrundsf칛rg i en figur.

-   col.main = rubrikens f칛rg.

-   col.lab = f칛rger f칬r rubrikerna p친 axlarna.

-   font = specificerar vilken typ av text man vill ha, exempelvis ger font = 3 kursiv text.
