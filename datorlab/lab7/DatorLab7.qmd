---
title: "Statistik och dataanalys I, 15 hp "
subtitle: "Datorlaboration 7 - Regression"
author: 
  - Mattias Villani
date: last-modified
format: 
  html:
    self-contained: true
toc: true
execute:
  error: false
language: 
  title-block-author-single: " "
toc-title-document: "Inneh친ll"
crossref-fig-title: "Figur"
theme: Superhero
title-block-banner-color: Primary
title-block-published: "Publicerad"
callout-warning-caption: "Varning"
callout-note-caption: "Observera"
callout-tip-caption: "Tips"
editor: visual
---

::: callout-warning
## Installera paket

Den h칛r labben f칬ruts칛tter att f칬ljande paket finns installerade:

-   `mosaic`
-   `sda1`

sda1 칛r kursens egna R-paket och m친ste installeras fr친n GitHub. Det g칬rs genom att f칬rst installera paketet remotes och d칛refter installera kurspaketet:

```{r}
#| output: false
library(mosaic)
# install.packages("remotes") # avkommentera f칬rsta g친ngen
library(remotes)
#install_github("StatisticsSU/sda1paket")  # avkommentera f칬rsta g친ngen
library(sda1)

```
:::

## Introduktion

> I den h칛r datorlabben kommer ni analysera olika datamaterial med regression. Det f칬rsta datamaterialet om reklam 칛r verkligt. I Uppgift 3 ska ni analysera datamaterial som 칛r simulerade av mig, fr친n olika populationsmodeller som jag har valt. Det blir ett intressant laboratorium, d칛r ni kan utforska olika aspekter av regression i en kontrollerad milj칬. Och 칛ven f친 veta den underliggande populationsmodellen efter att ni gjort labben!

::: callout-important
## Skapa mapp f칬r labben

Skapa en mapp `Lab7` i din kursmapp SDA1. Ladda ner Quarto-filen f칬r denna lab genom att h칬gerklicka [h칛r](https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/DatorLab7.qmd) och v칛lj 'Spara l칛nk' eller n친got likande fr친n menyn som dyker upp. Spara filen i din `Lab7` mapp. 칐ppna Quarto-filen i RStudio och forts칛tt med denna laboration direkt i Quarto-dokumentet, d칛r du ocks친 fyller i svaren p친 dina laborations칬vningar.
:::

## 1. Enkel regression f칬r reklamdata

Datamaterialet `reklam.csv` inneh친ller data p친 *n=200* produkters f칬rs칛ljning (`sales`) i tusentals US dollar och hur mycket (i s k reklamenheter) produkten har marknadsf칬rts i olika reklamkanaler: `tv`, `radio` och `newspaper`. Vi l칛ser in data med kommandot:

```{r}
reklam = read.csv(file = 'https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/reklam.csv')
head(reklam)
```

Vi b칬rjar med en enkel regressionsmodell med enbart `tv` som f칬rklarande variabel. Vi utforskar data genom histogram f칬r responsvariabeln `sales` och scatterplot mot `tv`.

```{r}
par(mfrow = c(1,2))
hist(reklam$sales, col = "orange", main = "")
plot(sales ~ tv, data = reklam, pch = 19, cex = 0.7, col = "steelblue")
```

#### 游눩 Uppgift 1.1

Skatta den enkla linj칛ra regressionsmodellen i R:

$$
\texttt{sales} = \beta_0 + \beta_1 \cdot \texttt{tv} + \varepsilon, \hspace{1cm} \varepsilon\overset{iid}{\sim}N(0,\sigma_{\varepsilon})
$$

och tolka skattningen av intercept och lutningskoefficient. Vilken skattning av $\sigma_{\varepsilon}$ ger R, och hur tolkar du denna?

#### 游눩 Uppgift 1.2

Testa om variabeln tv 칛r en signifikant f칬rklarande variabel p친 5% signifikansniv친. St칛ll upp noll- och alternativhypotes, teststatistiska med f칬rdelning under nollhypotesen. Utf칬r testet med hj칛lp av formelsamlingen och formulera din slutsats. Du f친r anv칛nda information fr친n R, men du ska st칛lla upp formeln f칬r teststatistikan ber칛kna alla delar av den formeln.

#### 游눩 Uppgift 1.3

Visa hur R har ber칛knat p-v칛rdet i regression-utskriften (fr친n `summary`) genom att g칬ra ber칛kningen sj칛lv med relevant s k `p`,`d`,`q`, eller `r`-funktion.

#### 游눩 Uppgift 1.4

G칬r en residualanalys med funktionen `reg_residuals` i `sda1`-paketet, och kommentera om var och ett av de fyra grundl칛ggande antaganden f칬r populationsmodellen verkar uppfyllda.

#### 游눩 Uppgift 1.5

G칬r en prediktion med 95%-iga prediktionsintervall f칬r `sales` vid `tv=100`. \[tips: argumentet `newdata` i `predict`-funktionen m친ste vara en dataframe, inte en vektor. Se min [kod f칬r lifespan data](https://statisticssu.github.io/SDA1/code/lifespan_regression.R).\]

## 2. Multipel regression f칬r reklamdata

Vi g친r nu vidare med en multipel regressionsmodell med alla tre f칬rklarande variabler: `tv`, `radio` och `newspaper`. F칬rst en titt p친 data:

```{r}
par(mfrow = c(2,2))
hist(reklam$sales, col = "orange", main = "")
plot(sales ~ tv, data = reklam, pch = 19, cex = 0.7, col = "steelblue")
plot(sales ~ radio, data = reklam, pch = 19, cex = 0.7, col = "steelblue")
plot(sales ~ newspaper, data = reklam, pch = 19, cex = 0.7, col = "steelblue")
```

#### 游눩 Uppgift 2.1

Anpassa f칬ljande multipla regressionsmodell:

$$
\texttt{sales} = \beta_0 
+ \beta_1 \cdot \texttt{tv} 
+ \beta_2 \cdot \texttt{radio} 
+ \beta_3 \cdot \texttt{newspaper} 
+ \varepsilon, \hspace{1cm} \varepsilon\overset{iid}{\sim}N(0,\sigma_{\varepsilon})
$$

och tolka skattningen av regressionskoefficienten f칬r `tv`.

#### 游눩 Uppgift 2.2

Testa om variabeln `tv` 칛r en signifikant f칬rklarande variabel p친 5% signifikansniv친. St칛ll upp noll- och alternativhypotes, teststatistiska med f칬rdelning under nollhypotesen. Utf칬r testet och formulera din slutsats. Du f친r anv칛nda information fr친n R, men du ska st칛lla upp formeln f칬r teststatistikan och ber칛kna den.

Kommentera kortfattat utifr친n utskriften om `radio` och `newspaper` 칛r signifikanta p친 5% signifikansniv친.

#### 游눩 Uppgift 2.3

Vilken modell, den enkla regressionen eller den multipla, f칬redrar du? Motivera med relevant R v칛rde och genom att g칬ra 5-fold korsvalidering med funktionen `reg_crossval` i `sda1`-paketet.

## 3. Residualanalys p친 simulerade data

Jag har simulerat fem olika datamaterial `simdata1-5` fr친n en linj칛r regressionsmodell:

$$
\texttt{y} = \beta_0 
+ \beta_1 \cdot \texttt{X1} 
+ \beta_2 \cdot \texttt{X2} 
+ \varepsilon
$$

d칛r i vissa datamaterial har feltermer $\varepsilon$ som inte uppfyller alla av de fyra antagandena, och eventuellt kan det ocks친 finnas ett icke-linj칛rt samband mellan n친gon f칬rklarande variabel och y. Er uppgift 칛r att utf칬ra residualanalys med funktionen `reg_residuals` i `sda1`-paketet f칬r att f칬rs칬ka uppt칛cka vilka antaganden som inte 칛r uppfyllda i respektive datamaterial (Uppgift 3.1-3.5 nedan). Ni b칬r ocks친 titta p친 `plot(simdata1)` f칬r varje datamaterial f칬r att uppt칛cka icke-linj칛ra samband.

H칛r 칛r de fem datamaterialen:

```{r}
simdata1 = read.csv(file = 'https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/simdata1.csv')
simdata2 = read.csv(file = 'https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/simdata2.csv')
simdata3 = read.csv(file = 'https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/simdata3.csv')
simdata4 = read.csv(file = 'https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/simdata4.csv')
simdata5 = read.csv(file = 'https://github.com/StatisticsSU/SDA1/raw/main/datorlab/lab7/simdata5.csv')
```

#### 游눩 Uppgift 3.1 - simdata1

#### 游눩 Uppgift 3.2 - simdata2

#### 游눩 Uppgift 3.3 - simdata3

#### 游눩 Uppgift 3.4 - simdata4

#### 游눩 Uppgift 3.5 - simdata5
